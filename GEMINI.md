# 株価データ分析ツール (Gemini用コンテキスト)

## プロジェクト概要
指定した複数の株式ティッカーシンボルについて、株価データを自動取得・分析し、テクニカル指標に基づく投資判断シグナルと総合スコアを出力するPythonツールの開発プロジェクトです。
GeminiエージェントのAI支援によって、コード実装の補助および機能拡張の提案を受けることを目的としています。

---

## 機能要件
- 指定されたティッカーリストファイル（`data/csv/tickers.csv`）を読み込み、各ティッカーの株価データをダウンロードする。
- 各銘柄について以下のテクニカル指標を計算する：
  - **RSI（相対力指数）**
  - **25日移動平均線からの乖離率**
  - **75日移動平均線のトレンド**
  - **MACD**
  - **DMI (方向性指数):** トレンドの方向性と転換点を分析
  - **ADX (平均方向性指数):** トレンドの強さを測定
- 各指標のシグナルに基づき、**投資判断の総合スコア**を算出する。
- 計算結果とシグナル、スコアを**PostgreSQLデータベース**に保存する。
- APIリクエストに応じて、**データベースから**特定条件に合致する銘柄をフィルタリングし、企業サイトや事業概要などの詳細情報を付加し、**スコア順にソート**してJSON形式で出力する。

---

## ディレクトリ構成

```
.
├── data/
├── src/
├── Dockerfile
├── requirements.txt
├── README.md
└── GEMINI.md
```

---

## 実装方針

### 1. 株価データ取得と指標計算 (`getTickersData.py`)

- **データ取得**
  - `tickers.csv`から銘柄コードを読み込み、`yfinance`を用いて過去株価データ（OHLCV）を取得する。
  - 過去75営業日以上のデータを確保。

- **テクニカル指標の計算と判定**
  - **RSI (14日):**
    - `< 25` → 「買い」
    - `25～40` → 「買い準備」
    - `> 75` → 「売り」
    - `60～75` → 「売り準備」
  - **25日移動平均乖離率:**
    - `≤ -5%` → 「買い」
    - `≥ +5%` → 「売り」
  - **75日移動平均トレンド:**
    - SMA75の傾きで上昇/下降/横ばいを判定。
  - **MACD (12, 26, 9):**
    - MACDライン > シグナルライン → 「買い」
    - MACDライン < シグナルライン → 「売り」
  - **DMI (14日):**
    - `+DI > -DI` (ゴールデンクロス) → 「買い」
    - `+DI < -DI` (デッドクロス) → 「売り」
  - **ADX (14日):**
    - ADX > 25 かつ `+DI > -DI` → 「強い上昇トレンド」
    - ADX > 25 かつ `+DI < -DI` → 「強い下降トレンド」

- **総合スコアリング**
  各シグナルに対して点数を加算し、買いスコアと空売りスコアを算出する。

  - **買いスコア (`buy_score`)**
    - RSI「買い」: **+2点**
    - RSI「買い準備」: **+1点**
    - 25日乖離率「買い」: **+2点**
    - 75日MA「上昇トレンド」: **+1点**
    - MACD「買い」: **+2点**
    - DMI「ゴールデンクロス」: **+2点**
    - ADX「強い上昇トレンド」: **+1点**

  - **空売りスコア (`short_score`)**
    - RSI「売り」: **+2点**
    - RSI「売り準備」: **+1点**
    - 25日乖離率「売り」: **+2点**
    - 75日MA「下降トレンド」: **+1点**
    - MACD「売り」: **+2点**
    - DMI「デッドクロス」: **+2点**
    - ADX「強い下降トレンド」: **+1点**

- **データベースへの保存**
  銘柄ごとに指標値・シグナル・スコアを含むデータを**PostgreSQLデータベース**に保存する。APIレスポンスとして、以下のようなJSON形式でデータを返すことを想定する。
  ```json
  {
    "ticker": "ABC.T",
    "price": 1500.0,
    "rsi": 24.5,
    "deviation_rate_25": -6.8,
    "trend": "Upward",
    "MACD": {
      "line": 10.5,
      "signal": 8.2
    },
    "DMI": {
      "dmp": 28.1, // +DI
      "dmn": 15.6  // -DI
    },
    "ADX": 26.2,
    "Volume": 1234500,
    "signals": {
      "RSI": "買い",
      "Divergence_25d": "買い",
      "MA75_Trend": "Upward",
      "MACD": "買い",
      "DMI": "ゴールデンクロス",
      "ADX": "強い上昇トレンド"
    },
    "buy_score": 8,
    "short_score": 0
  }
  ```

### 2. 銘柄フィルタリングと詳細情報追加 (`output.py`)

- **入力:** APIリクエスト
- **処理:**
  - **データベース**から銘柄データを読み込む。
  - APIリクエストの条件に基づき銘柄を絞り込む。
  - `yfinance.Ticker.info`から企業概要などを取得。
- **ソート:** 処理の最後に、全銘柄を**総合スコアの降順**で並び替える。
- **出力:** フィルタリング・ソートされた銘柄リストをJSON形式で出力する。

(以下、変更なし)
