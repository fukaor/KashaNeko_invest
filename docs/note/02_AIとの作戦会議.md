## STEP 2: 勝利の設計図（アーキテクチャ）を引く

次に、この要求を実現するための「設計図」がこれだ。
最強のAI軍団を編成するための、魂のコンポーネント図である。

```plantuml
@startuml
!theme vibrant
skinparam linetype ortho
actor ユーザー

package "フロントエンド" {
  component "React App (TypeScript)" as Frontend
}

package "バックエンド (Python)" {
  component "FastAPIサーバー" as FastAPI

  package "API & ルーター" {
    component "分析結果ルーター" as ResultRouter
    component "グラフデータルーター" as GraphRouter
  }

  package "コアロジック" {
    component "分析ロジック" as AnalysisLogic
    component "再評価ロジック" as ReEvalLogic
    component "グラフデータロジック" as ChartLogic
  }

  package "サービス" {
    component "生成AIサービス" as AIService
    component "スケジューラ (APScheduler)" as Scheduler
  }

  package "データ & 状態" {
    database "データベース (PostgreSQL)" as DB
    database "ファイルシステム" as FS {
      collections "tickers.csv"
    }
  }
}

package "外部サービス" {
  component "yfinance API" as YFinance
  component "NewsAPI" as NewsAPI
  component "生成AI API\n(例: Gemini)" as GenAI
  component "メール送信サービス\n(SMTP/API)" as MailService
}

' --- 接続 ---
ユーザー ----> Frontend: ブラウザで操作
Frontend ----> FastAPI: APIリクエスト (HTTP/JSON)

FastAPI --> ResultRouter
FastAPI --> GraphRouter

Scheduler ----> AnalysisLogic: 定時分析を実行
Scheduler ----> ReEvalLogic: 再評価をトリガー

AnalysisLogic ----> YFinance: 株価データ取得
AnalysisLogic ----> NewsAPI: 最新ニュース取得
AnalysisLogic ----> MailService: 通知メール送信
AnalysisLogic ----> DB: チューニングパラメータ読込
AnalysisLogic ----> AIService: 投資判断理由を取得
AnalysisLogic ----> DB: 新規投資判断を保存

GraphRouter ----> ChartLogic
ChartLogic ----> YFinance: 価格履歴を取得
ChartLogic ----> DB: 投資判断履歴を取得

ReEvalLogic ----> DB: 過去の投資判断を読込
ReEvalLogic ----> YFinance: 現在価格を取得
ReEvalLogic ----> AIService: 再評価を取得
ReEvalLogic ----> DB: チューニングパラメータを更新

AIService ----> GenAI: API呼び出し

@enduml
```
![alt text](img/architecture.png)

少し専門用語が多いが、怯むことはない。要するに、こういうことだ。

*   **バックエンド (Python):** 我が軍の頭脳であり心臓部。市場を分析し、戦略を立てる部隊がここに集結している。
    *   `AnalysisLogic`: 日々市場を監視し、投資判断を下す最前線の「分析部隊」。
    *   `ReEvalLogic`: 過去の戦績を評価し、次の戦術を練る「作戦参謀室」。
    *   `AIService`: 我らが最終兵器「生成AI」と連携し、分析に“知性”を与える。
*   **フロントエンド (TypeScript/React):** 僕が戦況を確認するための「司令室」。AIからの報告を美しいグラフで表示する。
*   **外部サービス:** `yfinance`から株価データを、`NewsAPI`から市場ニュースを仕入れる「情報収集部隊」。

これらの部隊が連携し、一つの生命体のように機能することで、巨大な資本市場に立ち向かう。

## 作戦会議は終わった。次は、AIの思考を覗く。

要求を定義し、設計図を描き終えた。

次回、いよいよこの設計図がどのように動くのか、その思考プロセスをシーケンス図で可視化する。

果たして、社畜エンジニアはAIと共に、自由への第一歩を踏み出せるのか。
残り99日の100日戦争、第3話。刮目して待て。